<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Game Loading...</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#e74c3c">
    <meta name="description"
        content="A place for all nostalgic gamers to relive old memories. ReLived by Shardul Pakhale.">
    <meta property="og:image" content="http://retrogamezone.droppages.com/nesicon.png">
    <meta property="og:title" content="Retro Game Zone - By Shardul Pakhale">
    <meta property="og:description"
        content="A place for all nostalgic gamers to relive old memories. ReLived by Shardul Pakhale.">
    <link rel="apple-touch-icon" href="http://retrogamezone.droppages.com/nesicon.png">
    <link rel="apple-touch-startup-image" href="http://retrogamezone.droppages.com/nesicon.png">
    <link rel="Shortcut Icon" href="favicon.ico" type="image/x-icon">
    <link rel="Bookmark" href="favicon.ico">
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        .infoSpn {
            font-size: 1.6em;
            font-weight: bolder;
            border: dashed 2px #D32F2F;
            color: #B71C1C;
            padding: 0.1em;
            padding-left: 0.8em;
            padding-right: 0.8em;
            margin-right: 1em;
            margin-left: 1em;
            border-radius: 100%;
            display: inline-block;
            transition: all 1s ease
        }

        .inputDiv {
            padding: 0;
            max-height: 0;
            margin: 1em 0;
            overflow: hidden;
            transition: all 1s ease;
            text-align: center;
        }

        .myForm {
            margin: .5em 0 1em 0;
            transition: all 1s ease;
        }

        .btn {
            width: 27%;
            margin: .4em .1em;
        }

        .inputDiv input {
            width: 70%;
            text-align: center;
            display: inline-block;
            margin: 0 .2em;
        }

        .inputDiv select {
            margin: 0 .2em;
            width: 20%;
            text-align: center;
            display: inline-block;
        }

        @media (max-width: 600px) {
            .btn-text {
                display: none;
            }

            #newButtonsDiv {
                bottom: 0;
                height: fit-content;
                margin: auto;
                left: 0 !important;
                top: 0 !important;
                width: 100%;
                text-align: center;
            }

            .inputDiv input {
                width: 100%;
                display: block;
                margin: 0 0 .2em 0;
            }

            .inputDiv select {
                margin: .2em 0 0 0;
                width: 100%;
                display: block;
            }
        }

        .container {
            padding-top: 1em;
        }

        #gameTitle {
            cursor: pointer;
            font-family: 'Pattaya', sans-serif;
        }

        #save_name:invalid {
            box-shadow: 0 0 0 1px #e74c3c;
        }

        #save_name:valid:focus {
            border-color: #8bc34a;
            box-shadow: 0 0 0 1px #8bc34a;
        }

        #save_name:disabled,
        #save_slot:disabled,
        #forceLoad:disabled {
            border-color: #535353;
            box-shadow: none;
            border-style: dashed solid;
            border-width: medium;
            color: inherit;
            cursor: copy;
            pointer-events: none;
        }

        #newButtonsDiv {
            position: absolute;
            top: .7em;
            left: .7em;
        }

        @-webkit-keyframes pulse {
            0% {
                -webkit-box-shadow: 0 0 0 0 rgba(139, 195, 74, 0.4);
            }

            70% {
                -webkit-box-shadow: 0 0 0 10px rgba(139, 195, 74, 0);
            }

            100% {
                -webkit-box-shadow: 0 0 0 0 rgba(139, 195, 74, 0);
            }
        }

        @keyframes pulse {
            0% {
                -moz-box-shadow: 0 0 0 0 rgba(139, 195, 74, 0.4);
                box-shadow: 0 0 0 0 rgba(139, 195, 74, 0.4);
            }

            70% {
                -moz-box-shadow: 0 0 0 10px rgba(139, 195, 74, 0);
                box-shadow: 0 0 0 10px rgba(139, 195, 74, 0);
            }

            100% {
                -moz-box-shadow: 0 0 0 0 rgba(139, 195, 74, 0);
                box-shadow: 0 0 0 0 rgba(139, 195, 74, 0);
            }
        }

        body {
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        @media (min-width: 600px) {
            .container>div {
                min-height: calc(100vh + env(safe-area-inset-top));
            }

            .ios_fs {
                overflow: hidden !important;
            }
        }

        .ejs--5e71fd80268afbb1d588e40b993508 input,
        .ejs--5e71fd80268afbb1d588e40b993508 textarea {
            background: #fafafa !important;
        }

        #toTop {
            filter: none !important;
            background-color: rgb(0, 0, 0, 0) !important;
            bottom: 1em;
            top: auto !important;
            left: auto;
            right: 1em;
            transform: scale(2);
        }
    </style>
    <style id="temp_style">
        @media (min-width: 600px) {
            #game canvas {
                width: 100% !important;
            }
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6C093H6NML"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-6C093H6NML');
    </script>
</head>

<body>
    <img src="fullS.png" width="24" height="24" title="FullScreen"
        style="display: inline; top: 0.3em; position: fixed; z-index: 1001; right: 0.3em; cursor: pointer; fill: #f44336"
        id="fsbutton" onclick="document.getElementById('gameFrame')?.contentWindow.clickMe();">
    <span class="fa-stack" title="GamePads"
        style="display: inline; line-height: 1.15; top: 0.3em; left: 0.15em; position: fixed; z-index:+1; color: #f44336; cursor: pointer;"
        id="gamepadicon" onclick="keybPrimaryPlayer.toggle()">
        <i class="fa fa-gamepad fa-stack-2x" style="line-height: 0.4;"></i>
    </span>
    <img id="forColorThief" style="display: none;">
    <header id="header" class="preview">
        <div class="inner" onClick="document.getElementById('homeButton').click();" style="cursor: pointer;">
            <div class="content">
                <h1>Retro Game Zone</h1>
                <h2>A place for all nostalgic gamers to relive old memories.</h2>
                <a href="index.html" class="button big alt">
                    <span>Let's Play</span>
                </a>
            </div>
            <a href="index.html" class="button hidden" id="homeButton">
                <span>Let's Play</span>
            </a>
        </div>
    </header>
    <div class="container">
        <div id="game"></div>
    </div>
    <div id="preview">
        <div class="inner">
            <div class="image fit">
                <iframe name="gameFrame" id="gameFrame" style="width: 100%; height: 693px; transition: all 0.9s;"
                    scrolling="no"></iframe>
            </div>
            <div class="content">
                <header>
                    <center>
                        <h2 id="gameTitle">&nbsp;</h2>
                    </center>
                    <div id="gameName" style="display: none;">&nbsp;</div>
                </header>
                <div class="inputDiv">
                    <center>
                        <h4 style="color: inherit;">The <big>Secret Save</big></h4>
                    </center>
                    <form class="myForm" onsubmit="return validateForm()">
                        <input type="search" id="save_name" placeholder="enter a unique save name"
                            pattern="^(?=[a-zA-Z0-9\-_]{1,70}$)(?![_\-])(?!.*[_\-]{2})([a-zA-Z0-9\-_]*[a-zA-Z0-9])"
                            title="only alphabets followed by numbers or hyphen(-) are allowed, don't use spaces or special characters"
                            maxlength="20" autocorrect="off" autocapitalize="none">
                        <select id="save_slot">
                            <option value="">Default Slot</option>
                            <option value="slot1">Slot 1</option>
                            <option value="slot2">Slot 2</option>
                            <option value="slot3">Slot 3</option>
                            <option value="slot4">Slot 4</option>
                            <option value="slot5">Slot 5</option>
                            <option value="slot6">Slot 6</option>
                            <option value="slot7">Slot 7</option>
                        </select>
                    </form>
                    <button class="btn" onclick="dwnSaveState()"><i class="fa fa-lg fa-floppy-o" aria-hidden="true"></i>
                        <span class="btn-text">Download Save File</span></button>
                    <span class="wrap" onclick="$('#forceLoad').attr('disabled', false)">
                        <button class="btn" id="forceLoad" onclick="saver.fetchStateAndLoad();" disabled>
                            <i class="fa fa-lg fa-cloud-download" aria-hidden="true"></i> <span class="btn-text">Load
                                from Cloud</span></button></span>
                    <button class="btn" onclick="opnSaveState()"><i class="fa fa-lg fa-folder-open-o"
                            aria-hidden="true"></i> <span class="btn-text">Upload Save File</span></button>
                </div>
                <h4 style="font-size: x-large; color: #e74c3c;">
                    Controls
                    <i class="fa fa-exchange" onclick="keybPrimaryPlayer.toggle()" title="Swap Players"
                        style="cursor: pointer; color: rgb(244, 67, 54);"></i>
                </h4>
                <img class="controllers" src="//cdn.jsdelivr.net/gh/omssp/nesscraper/images/controller1.png"
                    alt="Controller 1" />
                <img class="controllers" src="//cdn.jsdelivr.net/gh/omssp/nesscraper/images/controller2.png"
                    alt="Controller 2" />
                <center>
                    <table id="controls">
                        <tr>
                            <th>Button</th>
                            <th>Player 1</th>
                            <th>Player 2</th>
                        </tr>
                        <tr>
                            <td>Left</td>
                            <td>A</td>
                            <td>Left</td>
                        <tr>
                            <td>Right</td>
                            <td>D</td>
                            <td>Right</td>
                        </tr>
                        <tr>
                            <td>Up</td>
                            <td>W</td>
                            <td>Up</td>
                        </tr>
                        <tr>
                            <td>Down</td>
                            <td>S</td>
                            <td>Down</td>
                        </tr>
                        <tr>
                            <td>A</td>
                            <td>L</td>
                            <td>NUM - .</td>
                        </tr>
                        <tr>
                            <td>B</td>
                            <td>K</td>
                            <td>NUM - 0</td>
                        </tr>
                        <tr>
                            <td>Start</td>
                            <td>H / Enter</td>
                            <td>NUM - 2</td>
                        </tr>
                        <tr>
                            <td>Select</td>
                            <td>G / Ctrl</td>
                            <td>NUM - 1</td>
                        </tr>
                    </table>
                </center>

                <p>
                    <br /> Keyboard Shortcuts &nbsp;-<br>
                    <center>
                        <span class="infospan">M : Mute/UnMute</span>
                        <span class="infospan">P : Swap Players</span>
                        <span class="infospan">R : Power/Reset</span>
                        <span class="infospan">F : Immersive Mode</span>
                        <span class="infospan">SHIFT + LEFT : Previous Game</span>
                        <span class="infospan">SHIFT + RIGHT : Next Game</span>
                        <span class="infospan">SHIFT + UP : Home</span>
                        <span class="infospan">SPACEBAR : Pause/Resume</span>
                        <!--span class="infospan">BACKSPACE : Go To HOME</span-->
                    </center>
                </p>
            </div>
        </div>
        <a href="game.html" class="nav previous" id="previousGame">
            <span class="fa fa-chevron-left"></span>
        </a>
        <a href="game.html" class="nav next" id="nextGame">
            <span class="fa fa-chevron-right"></span>
        </a>
        <a class="nav top" id="toTop">
            <span class="fa fa-chevron-up"></span>
        </a>
    </div>
    <footer id="footer">
        <a style="cursor: pointer!important;" class="info fa fa-info-circle">
            <span>About</span>
        </a>
        <div class="inner">
            <div class="content">
                <h3 style="margin: 0 0 0 0; font-size:23px;">
                    A website by <a href="https://www.fb.com/omssp" target="_blank">Shardul Pakhale</a>
                </h3>
            </div>
            <div class="copyright" style="text-align: right;">
                &copy; Shardul Pakhale | Moblie:
                <small>
                    <a href="tel: +918793687422">+918793687422</a>
                </small> | Visit: <a href="http://vomkar.droppages.com" target="_blank">Vomkar's Creations</a>
            </div>
        </div>
    </footer>
    <div id="preloaderWrapper">
        <div id="preloader">
            <img src="preloader.gif">
        </div>
    </div>
    <script src="assets/js/jquery.min.js"></script>
    <script src="MaterialColorThief.js"></script>
    <script src="lib/gamelist.js"></script>
    <script src="lib/swapplayers.js"></script>
    <script src="lib/audioUI.js"></script>
    <script src="lib/slugify.js"></script>
    <script src="lib/cookie.js"></script>
    <script src="emu/pako.js"></script>
    <script src="emu/save.js"></script>
    <script src="emu/emu.js"></script>
    <script>

        const materialColorThief = new MaterialColorThief();

        var keybPrimaryPlayer = new KeyboardPrimaryPlayer();

        var para = 1;
        var url = document.location.href;
        if (url.indexOf('?') != -1) {
            para = parseInt(url.split('?')[1].split('&')[0]);
        }
        window.onload = function () {

            document.getElementById('gameName').innerHTML = window.EJS_gameUrl = gameNameArray[para][1];
            document.getElementById('gameTitle').innerHTML = document.title = window.EJS_gameName = gameNameArray[para][0];


            let currHrs = new Date().getHours();
            const darkMode = (currHrs > 18 || currHrs < 6) || window.matchMedia("(prefers-color-scheme: dark)").matches;

            let rgbVals = '33,33,33';

            let imagetag = document.getElementById('forColorThief');
            imagetag.crossOrigin = "anonymous";
            imagetag.src = gameNameArray[para][2];

            $(imagetag).load(() => {

                if (darkMode) {
                    $('body, table th').css('color', '#eeeeee');
                    $('#gameFrame').contents().find('.nes-status').css('color', '#eeeeee');
                    $('#fsbutton, #gamepadicon, .nav').css('filter', 'drop-shadow(0 0 1px #fafafa)');
                    $('#gameFrame').contents().find('#mubutton, #powbutton, #ppbutton').css('filter', 'drop-shadow(0 0 2px #9e9e9e)');
                    $('#gameTitle, h4').css('text-shadow', '0px 0px 20px #9e9e9e');
                    rgbVals = materialColorThief.getDarkestMaterialColor(imagetag).join(',');
                } else {

                    rgbVals = materialColorThief.getBrightestMaterialColor(imagetag).join(',');
                }

                updateBackgrounds(rgbVals);
            });


        };
        const updateBackgrounds = (backgroundColorRGB) => {
            $('body, .nav').css("background-color", `rgb(${backgroundColorRGB})`);
            $('#header .inner').css("box-shadow", `0 0 0 1em rgb(${backgroundColorRGB})`);
            $('#footer > a').css("color", `rgb(${backgroundColorRGB})`);
            $('#header.hide .button.hidden, #header.preview .button.hidden').attr('data-content', `rgb(${backgroundColorRGB})`)
        }

        $('.controllers').hover(function () {
            $(this).css('cursor', "url('controls/nespad.ico'), auto");
        });
        let debounce;
        $(window).resize(function () {
            if (debounce)
                clearTimeout(debounce)
            debounce = setTimeout(() => {
                // alert($(window).width());
                checkWidth(document.documentElement.offsetWidth);
            }, 500);
        });
        $(document).ready(function () {

            $(document).on("contextmenu", function (e) { e.preventDefault(); return false; });

            if (window.history && window.history.pushState) {
                window.history.pushState('forward', null, '');
                $(window).on('popstate', function () {
                    setCookie('two-go', null);
                    window.location.replace('index.html');
                });
            }
            const isMobile = ('ontouchstart' in document.documentElement);
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            if (!isChrome && isMobile &&
                !(document.documentElement.requestFullscreen ||
                    document.documentElement.mozRequestFullScreen ||
                    document.documentElement.webkitRequestFullscreen ||
                    document.documentElement.msRequestFullscreen)) {
                $('#fsbutton').fadeOut("slow");
            }

            window.addEventListener("gamepadconnected", (event) => {
                $('#gamepadicon').fadeIn("slow");
                keybPrimaryPlayer.setSwapped();
                checkandchange();
                console.log("A gamepad connected:");
                console.log(event.gamepad);
            });
            window.addEventListener("gamepaddisconnected", (event) => {
                $('#gamepadicon').fadeOut("slow");
                keybPrimaryPlayer.resetSwapped();
                checkandchange();
                console.log("A gamepad disconnected:");
                console.log(event.gamepad);
            });
            $('#gamepadicon').fadeOut("slow");

            if (debounce)
                clearTimeout(debounce)
            debounce = setTimeout(function () {
                checkWidth(document.documentElement.offsetWidth);
            }, 1300);

            var nexG = (para + 1) % gameNameArray.length;
            var preG = para - 1;
            if (preG < 0)
                preG = gameNameArray.length - 1;
            $('#previousGame').attr("href", "game.html?" + preG.toString());
            $('#nextGame').attr("href", "game.html?" + nexG.toString());

            $("a").each(function () {
                let thref = $(this).attr('href');
                if (thref) {
                    $(this).removeAttr('href');
                    $(this).css("cursor", "pointer");
                    $(this).unbind("click").on("click", function () {
                        window.selectAudio.playclip();
                        setCookie('two-go', null);
                        window.setTimeout(() => {
                            window.location.replace(thref);
                        }, window.selectAudio.duration * 1000);
                    });
                }
            });
            setTimeout(checkandchange, 1000);

            if (navigator.share) $('#gameTitle').append(' <i class="fa fa-share-square-o"></i>')

            const isIpad = /Macintosh/i.test(navigator.userAgent) && navigator.maxTouchPoints && navigator.maxTouchPoints > 1;
            if (/(iPad|iPhone|iPod)/gi.test(navigator.userAgent) || isIpad) {
                $('body').addClass('ios_fs')
            }
        });

        $('#toTop').click(() => {
            $('#game')[0].scrollIntoView({
                behavior: "smooth",
                block: "center",
                inline: "center"
            })
        });

        function checkWidth(curWidth) {
            $('#save_name').is(':focus') ? '' : ($('#game, iframe')[0]?.scrollIntoView({
                behavior: "smooth",
                block: "center",
                inline: "center"
            }), document.getElementById('gameFrame')?.contentWindow.focusMe());
            let nesCanvas = $('#gameFrame').contents().find('#nescanvas');
            if (curWidth < 500 && nesCanvas[0]?.offsetHeight > 400) {
                nesCanvas.click();
            } else if (curWidth > 500 && nesCanvas[0]?.offsetHeight < 245) {
                nesCanvas.click();
            }
        }
        $(window).scroll(function () {
            currentScroll = $(window).scrollTop();
            if (20 < currentScroll && currentScroll < 120) {
                window.focus();
                $('#header.preview, #previousGame, #nextGame, #footer').css("z-index", '-1');
            } else {
                $('#header.preview, #previousGame, #nextGame, #footer').css("z-index", '1');
            }
            if (currentScroll > 120) {
                $('#toTop').fadeIn();
            } else {
                $('#toTop').fadeOut();
            }
        });

        function checkandchange() {
            const initial_gamepads = window.navigator.getGamepads().filter(o => o).length;
            console.log(initial_gamepads)
            if (!initial_gamepads) {
                loadEMU();
            } else if (!$('#gameFrame').length) {
                unLoadEMU();
            } else {
                $('#preloaderWrapper').fadeOut()
            }
        }

        $(document).bind('keydown', function (e) {
            if (!$('#save_name').is(':focus') &&
                document.activeElement.tagName != "TEXTAREA" &&
                document.activeElement.tagName != "INPUT") {
                if (e.keyCode == 32) {
                    window.play_toggle();
                    e.preventDefault();
                }
                if (e.keyCode == 82) {
                    window.reset_game();
                    e.preventDefault();
                }
                if ((e.keyCode == 8) ||
                    (e.keyCode == 38 && (e.altKey || e.shiftKey))) {
                    document.getElementById('homeButton').click();
                    e.preventDefault();
                }
                if ((e.keyCode == 78 && (e.altKey || e.shiftKey)) ||
                    (e.keyCode == 39 && (e.altKey || e.shiftKey))) {
                    document.getElementById('nextGame').click();
                    e.preventDefault();
                }
                if ((e.keyCode == 80 && (e.altKey || e.shiftKey)) ||
                    (e.keyCode == 37 && (e.altKey || e.shiftKey))) {
                    document.getElementById('previousGame').click();
                    e.preventDefault();
                }
                // if (e.keyCode == 80) {
                //     keybPrimaryPlayer.toggle();
                //     e.preventDefault();
                // }
                if (e.keyCode == 77 || e.keyCode == 173) {
                    window.mute_toggle();
                    e.preventDefault();
                }
                if (e.keyCode == 122 || e.keyCode == 70) {
                    window.fulls_toggle();
                    e.preventDefault();
                }
                if (e.keyCode == 192) {
                    if (!loadEMU()) {
                        unLoadEMU()
                    }
                    e.preventDefault();
                }
                $('#game, iframe')[0]?.scrollIntoView({
                    behavior: "smooth",
                    block: "center",
                    inline: "center"
                });
                document.getElementById('gameFrame')?.contentWindow.focusMe();
            }
            if (e.keyCode == 90) {
                toggleStretchMode();
            }
        });


        function toggleStretchMode() {
            const tempCSS = $('#temp_style')
            if (tempCSS.html()) {
                tempCSS.html('');
            } else {
                tempCSS.html(`@media (min-width: 600px) { #game canvas { width: 100% !important; } }`);
            }
        }

        function loadEMU() {
            const gameFrame = document.getElementById('gameFrame');
            if (gameFrame) {
                gameFrame.remove();
                $('.container').css("padding-top", '4em');

                const script = document.createElement("script");
                script.src = "emu/data/loader.js";
                script.id = 'loaderJS';

                $('#fsbutton').click(window.fulls_toggle);

                const saveName = getCookie('save_name')?.trim()
                if (saveName) {
                    window.saver = new SaveHandler(saveName);
                    window.EJS_onSaveState = (e) => window.saver.saveToOnline(e)
                    window.EJS_onGameStart = (e) => {
                        window.saver.loadFromOnline(e)
                        onGameStart()
                    }
                    save_name.val(saveName).css('animation', 'none').attr('disabled', true).attr('title', 'click to edit')
                    const saveSlot = getCookie(`${window.saver.game_slug}-save_slot`)
                    save_slot.val(saveSlot).css('animation', 'none').attr('disabled', true).attr('title', 'click to edit')
                    window.saver.set_slot(saveSlot)
                    old_slot = saveSlot
                    old_input = saveName
                } else {
                    window.EJS_onSaveState = () => { }
                    window.EJS_onGameStart = onGameStart;
                }

                document.body.appendChild(script);
                return true
            }
            return false
        }

        function onGameStart() {
            $('#preloaderWrapper').fadeOut()
            moveUIButtons()
            setInterval(window.save_local, 5e4);
            window.addEventListener("blur", window.save_local);
        }

        function moveUIButtons() {
            if ((window.ejs_media || window._0x378b5c).virtualGamepadContainer) {
                const newButtonsDiv = document.createElement('div');
                newButtonsDiv.id = "newButtonsDiv";
                newButtonsDiv.appendChild(window.EJS_emulator.elements.buttons.play[0]);
                newButtonsDiv.appendChild(window.EJS_emulator.elements.buttons.restart);
                newButtonsDiv.appendChild(window.EJS_emulator.elements.buttons.mute);
                // newButtonsDiv.appendChild(document.createElement('br'));
                // newButtonsDiv.appendChild(window.EJS_emulator.elements.buttons.saveState);
                // newButtonsDiv.appendChild(window.EJS_emulator.elements.buttons.loadState);
                window.EJS_emulator.elements.container.appendChild(newButtonsDiv)
                window.EJS_emulator.elements.inputs.volume.hidden = false;
                window.EJS_emulator.elements.buttons.mute.hidden = false;
                window.EJS_emulator.elements.buttons.cheat.hidden = false;
                window.EJS_emulator.elements.buttons.play[0].addEventListener("click", () => {
                    if (window.EJS_emulator.playing) toggleStretchMode()
                })
            }
        }

        function unLoadEMU() {
            const loaderJS = document.getElementById('loaderJS');
            if (loaderJS) {
                loaderJS.remove();
                window.EJS_terminate()
                $('#fsbutton').off('click');
                $('.image.fit').html(`<iframe name="gameFrame" id="gameFrame" src="index2.html" style="width: 100%; height: 693px; transition: all 0.9s; margin-top: 15px;" scrolling="no"></iframe>`);
                $('.container').css("padding-top", '1em').html(`<div id="game"></div>`);
                return true;
            }
            return false;
        }
        let debounce_input;
        let debounce_toggle;
        let old_input;
        let old_slot;
        const save_name = $('#save_name').on('keyup paste search', debounceChange);
        const save_slot = $('#save_slot').on('change', validateForm);
        const inputDiv = $('.inputDiv');
        function validateForm() {
            if (debounce_input)
                clearTimeout(debounce_input)
            if (save_name.is(':valid')) {
                old_input = save_name.css('animation', 'none').attr('disabled', true).attr('title', 'click to edit').blur().val().trim();
                old_slot = save_slot.css('animation', 'none').attr('disabled', true).attr('title', 'click to edit').val()

                window.save_local()
                setCookie('save_name', old_input, 365)

                window.saver = new SaveHandler(old_input);
                window.saver.set_slot(old_slot);
                setCookie(`${window.saver.game_slug}-save_slot`, old_slot, 365)
                if (window.EJS_emulator) {
                    if (navigator.vibrate) navigator.vibrate([50]);
                    window.EJS_emulator.config.onsavestate = old_input ? (e) => window.saver.saveToOnline(e) : () => { };
                    // window.EJS_emulator.on('start-game', window.saver.loadFromOnline)
                    saver.loadFromOnline()
                }

                if (debounce_toggle)
                    clearTimeout(debounce_toggle)
                setTimeout(() => {
                    toggleSecretSave('hide');
                }, 6e4);
            }
            return false;
        }
        function debounceChange() {
            let new_input = save_name.val().replaceAll(' ', '-');
            save_name.val(new_input);
            if (old_input != new_input) {
                save_name.css('animation', 'pulse 1s infinite')
                save_slot.css('animation', 'pulse 1s infinite')
                if (debounce_input)
                    clearTimeout(debounce_input)
                if (debounce_toggle)
                    clearTimeout(debounce_toggle)
                debounce_input = setTimeout(() => {
                    validateForm();
                }, 4000);
            }
        }
        $('.inputDiv .myform').on('click', () => {
            if (save_name.is(':disabled')) {
                save_name.attr('disabled', false).css('cursor', 'auto').attr('title', "only alphabets followed by numbers or hyphen(-) are allowed, don't use spaces or special characters")
                save_slot.attr('disabled', false).css('cursor', 'auto').attr('title', "select your save game slot")
            }
        });

        const toggleSecretSave = (hide) => {
            if (!window.EJS_emulator) return;
            if (inputDiv.css('max-height') == "200px" || hide === 'hide') {
                inputDiv.css('max-height', "0").css('padding', "0");
                $('#forceLoad').attr('disabled', 'true');
            } else {
                inputDiv.css('max-height', "200px").css('padding', "0 1em");
                if (debounce_toggle)
                    clearTimeout(debounce_toggle)
                setTimeout(() => {
                    toggleSecretSave('hide');
                }, 6e4);
                if (navigator.share) {
                    navigator.share({
                        title: document.title,
                        url: document.location.href
                    }).then(() => {
                        console.log('Thanks for sharing!');
                    }).catch(console.error);
                }
            }
        }

        $('#gameTitle').on('click', toggleSecretSave);

        const dwnSaveState = () => {
            if (window.EJS_emulator) {
                window.EJS_emulator.config.onsavestate = null;
                window.save_state();
                setTimeout(() => {
                    window.EJS_emulator.config.onsavestate = (e) => window.saver.saveToOnline(e);
                }, 500);
                if (debounce_toggle)
                    clearTimeout(debounce_toggle)
                setTimeout(() => {
                    toggleSecretSave('hide');
                }, 6e4);
            }
        }
        const opnSaveState = () => {
            if (window.EJS_emulator) {
                window.EJS_emulator.game.stateloadField.click()
                if (debounce_toggle)
                    clearTimeout(debounce_toggle)
                setTimeout(() => {
                    toggleSecretSave('hide');
                }, 6e4);
            }
        }
    </script>
    <script type="text/javascript">
        if (navigator.serviceWorker) {
            navigator.serviceWorker
                .register('./sw.js')
                .then((reg) => {
                    console.log('Service Worker Registered. ', reg)
                })
                .catch((error) => {
                    console.log('Service Worker registration failed: ', error)
                })
        }
    </script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
</body>

</html>